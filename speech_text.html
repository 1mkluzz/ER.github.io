<!DOCTYPE html>
<html lang="en">
  <head>
      <title>Browser speech recognition</title>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <link type="text/css" rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
    <link rel="stylesheet" href="./css/style3.css" />
    <style>
        button{
          margin: 10px 5px;
        }
        li{
          margin: 10px;
        }
        body{
          width: 90%;
          max-width: 960px;
          margin: 0px auto;
        }
        #btns{
          display: none;
        }
        h1{
          margin: 100px;
        }
      </style>


  </head>
  <body>

    <h1>Grave o áudio que deseja adicionar ao ficheiro</h1>
    <div id='gUMArea'>
      <div>
      Deseja gravar:
        <input type="radio" name="media" value="video" checked id='mediaVideo'> Webcam e áudio
        <input type="radio" name="media" value="audio">Áudio
      </div>
      <button class="btn btn-default"  id='gUMbtn'>Gravar</button>
    </div>	
    <div id='btns'>
      <button class="btn btn-default" id='start'>Começar</button>
      <button  class="btn btn-default" id='stop'>Finalizar</button>
    </div>
    <div>
      <ul  class="list-unstyled" id='ul'></ul>
    </div>
    <main>
        <div id="result"></div>
        <p id="message" hidden aria-hidden="true">
            Your browser doesn't support Speech Recognition. Sorry.
        </p>
    </main>
    <script src="https://code.jquery.com/jquery-2.2.0.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
    <script src="js/recorder.js"></script>
    <script>
      window.addEventListener("DOMContentLoaded", () => {
        const button = document.getElementById("start");
        const button_fechar = document.getElementById("stop");
        const result = document.getElementById("result");
        const main = document.getElementsByTagName("main")[0];
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition
        if (typeof SpeechRecognition === "undefined") {
            button.remove();
            const message = document.getElementById("message");
            message.removeAttribute("hidden");
            message.setAttribute("aria-hidden", "false");
        } else {
            let listening = false;
            const recognition = new SpeechRecognition();
            const start = () => {
                recognition.start();
                button.textContent = "Começar";
                main.classList.add("speaking");
            };
            const stop = () => {
                recognition.stop();
               // button.textContent = "Começar";
                main.classList.remove("speaking");
            };
            const onResult = event => {
                result.innerHTML = "";
                for (const res of event.results) {
                    const text = document.createTextNode(res[0].transcript);
                    const p = document.createElement("p");
                    if (res.isFinal) {
                    p.classList.add("final");
                    }
                    p.appendChild(text);
                    result.appendChild(p);
                }
            }
            recognition.continuous = true;
            recognition.interimResults = true;
            recognition.addEventListener("result", onResult);

           /* button.addEventListener("click", () => {
            listening ? stop() : start();
            listening = !listening;
            });*/
            button.addEventListener("click", () => {
                start();
            });
            button_fechar.addEventListener("click", () => {
                stop();
            });
        }
    });
    </script>
  </body>
</html>